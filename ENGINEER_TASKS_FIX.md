# 🔧 إصلاح مشكلة عدم ظهور المهام للمهندسين

## 🎯 المشكلة
المهندسين (عمرو رمضان، محمد مجدي، كرم عبدالرحمن) لا تظهر لهم المهام في صفحة المهام بالرغم من وجود مهام مخصصة لهم في قاعدة البيانات.

## 🔍 سبب المشكلة
عدم تطابق بيانات المستخدمين بين:
- **Frontend (lib/auth.ts):** بيانات mock للمستخدمين
- **Backend (قاعدة البيانات):** بيانات المستخدمين الفعلية

### البيانات القديمة (غير صحيحة):
```javascript
// lib/auth.ts - البيانات القديمة
{
  name: "عمرو رمضان",
  email: "ar@nc",        // ❌ خاطئ
  password: "ar123",     // ❌ خاطئ
  role: "engineer"
},
{
  name: "محمد مجدي", 
  email: "mm@nc",        // ❌ خاطئ
  password: "mm123",     // ❌ خاطئ
  role: "engineer"
}
```

### البيانات الصحيحة:
```javascript
// البيانات الصحيحة من قاعدة البيانات
{
  name: "عمرو رمضان",
  email: "ar@nc.com",    // ✅ صحيح
  password: "ar@nc.com", // ✅ صحيح
  role: "engineer"
},
{
  name: "محمد مجدي",
  email: "mm@nc.com",    // ✅ صحيح  
  password: "mm@nc.com", // ✅ صحيح
  role: "engineer"
},
{
  name: "كرم عبدالرحمن",
  email: "ka@nc.com",    // ✅ صحيح
  password: "ka@nc.com", // ✅ صحيح
  role: "engineer"
}
```

## 🛠️ الحلول المطبقة

### 1. تحديث بيانات المستخدمين في Frontend
**الملف:** `lib/auth.ts`
- تحديث `mockUsers` لتتطابق مع قاعدة البيانات
- إضافة المهندس الجديد (كرم عبدالرحمن)

### 2. إنشاء سكريبت تحديث قاعدة البيانات
**الملف:** `backend/scripts/update_engineer_users.js`
- تحديث بيانات المهندسين الموجودين
- إضافة المهندس الجديد
- عرض قائمة جميع المستخدمين

### 3. تحسين Debug Logs
**الملف:** `app/tasks/page.tsx`
- إضافة logs مفصلة لتتبع عملية فلترة المهام
- عرض تفاصيل المهام والمستخدمين

## 📋 خطوات التطبيق

### 1. تشغيل سكريبت تحديث قاعدة البيانات
```bash
cd backend
node scripts/update_engineer_users.js
```

### 2. التحقق من النتائج
```bash
# يجب أن تظهر رسائل مثل:
# 🔄 تحديث المستخدم: ar@nc -> ar@nc.com
# ✅ تم تحديث المستخدم: عمرو رمضان - ar@nc.com
# ➕ إضافة المهندس الجديد: كرم عبدالرحمن
# ✅ تم إضافة المهندس: كرم عبدالرحمن - ka@nc.com
```

### 3. اختبار تسجيل الدخول
**بيانات تسجيل الدخول للمهندسين:**
- **عمرو رمضان:** `ar@nc.com` / `ar@nc.com`
- **محمد مجدي:** `mm@nc.com` / `mm@nc.com`  
- **كرم عبدالرحمن:** `ka@nc.com` / `ka@nc.com`

## 🔍 للاختبار والتشخيص

### 1. فتح Developer Console
- اضغط `F12` في المتصفح
- اذهب إلى تبويب `Console`

### 2. البحث عن Debug Logs
```javascript
// يجب أن تظهر رسائل مثل:
🔍 Tasks Debug: {
  totalTasks: 6,
  currentUser: "محمد مجدي",
  currentUserRole: "engineer", 
  currentUserId: "688230b285899c13a64664bb",
  searchedTasks: 6,
  projectFilter: "all",
  tasks: [
    { id: "...", title: "...", assigneeId: "688230b285899c13a64664bb", status: "todo" }
  ]
}
```

### 3. التحقق من فلترة المهام
```javascript
// يجب أن تظهر رسائل مثل:
✅ Task passed filter: {
  taskId: "...",
  taskTitle: "...",
  assigneeId: "688230b285899c13a64664bb",
  currentUserId: "688230b285899c13a64664bb",
  userFilter: true,
  projectFilterResult: true
}
```

## 🎯 النتائج المتوقعة

### للمديرين (مصطفى، محمد قطب):
- يروا جميع المهام في النظام

### للمهندسين (عمرو، محمد مجدي، كرم):
- يروا فقط المهام المخصصة لهم
- لا يروا مهام المهندسين الآخرين

## ⚠️ ملاحظات مهمة

1. **تحديث قاعدة البيانات مطلوب:** يجب تشغيل سكريبت التحديث أولاً
2. **تسجيل الخروج وإعادة الدخول:** قد يكون مطلوباً بعد التحديث
3. **Clear Browser Cache:** قد يكون مطلوباً لحذف البيانات القديمة

## 🚀 بعد التطبيق

1. **Netlify:** سيعيد النشر تلقائياً (2-3 دقائق)
2. **Render:** سيعيد النشر تلقائياً (1-2 دقيقة)
3. **اختبار:** جرب تسجيل الدخول بالمهندسين الجدد

## 📞 في حالة استمرار المشكلة

1. تحقق من Console Logs
2. تأكد من تشغيل سكريبت التحديث
3. تحقق من اتصال قاعدة البيانات
4. تأكد من تطابق بيانات المستخدمين 